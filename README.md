# ü§ñ AI Chat –∑ RAG + Vector Admin Panel

**–í–µ—Ä—Å—ñ—è:** 7.1  
**–ê–≤—Ç–æ—Ä:** AI Chat System  
**–õ—ñ—Ü–µ–Ω–∑—ñ—è:** MIT

---

## üìã –û–ø–∏—Å –ø—Ä–æ–µ–∫—Ç—É

–¶–µ–π –ø—Ä–æ–µ–∫—Ç —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –¥–≤–æ—Ö –≤–∑–∞—î–º–æ–ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤:

1. **index.php** - AI —á–∞—Ç-–±–æ—Ç –∑ –≤–µ–∫—Ç–æ—Ä–Ω–∏–º –ø–æ—à—É–∫–æ–º (RAG - Retrieval Augmented Generation)
2. **vector_admin.php** - –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞ –ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≤–µ–∫—Ç–æ—Ä–Ω–æ—é –±–∞–∑–æ—é –∑–Ω–∞–Ω—å

### –ö–ª—é—á–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

‚ú® **AI –ß–∞—Ç (index.php):**
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ OpenRouter API –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä—ñ–∑–Ω–∏—Ö AI –º–æ–¥–µ–ª–µ–π
- RAG (Retrieval Augmented Generation) - –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤–µ–∫—Ç–æ—Ä–Ω–æ—ó –±–∞–∑–∏ –∑–Ω–∞–Ω—å
- –°–µ–º–∞–Ω—Ç–∏—á–Ω–∏–π –ø–æ—à—É–∫ —á–µ—Ä–µ–∑ PostgreSQL –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º pgvector
- –Ü—Å—Ç–æ—Ä—ñ—è —Ä–æ–∑–º–æ–≤ –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –æ—á–∏—â–µ–Ω–Ω—è
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ Markdown —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
- –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å —É —á–∞—Ç—ñ
- –í—ñ–∑—É–∞–ª—å–Ω–∞ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è RAG —Ç–∞ –¥–∂–µ—Ä–µ–ª —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó

üõ†Ô∏è **–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å (vector_admin.php):**
- –ü–æ–≤–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –≤ –≤–µ–∫—Ç–æ—Ä–Ω—ñ–π –±–∞–∑—ñ
- –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –æ–∫—Ä–µ–º–∏—Ö —á–∞–Ω–∫—ñ–≤ –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º –µ–º–±–µ–¥–¥—ñ–Ω–≥—ñ–≤
- –ü–∞–∫–µ—Ç–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ (TXT, MD, HTML, CSV, JSON)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ –±–∞–∑–∏ –∑–Ω–∞–Ω—å
- –ï–∫—Å–ø–æ—Ä—Ç/—ñ–º–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö —É JSON —Ñ–æ—Ä–º–∞—Ç—ñ
- –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ—à—É–∫—É
- –ü–æ—à—É–∫ —ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤

---

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏

### –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π —Å—Ç–µ–∫

- **Backend:** PHP 7.4+ (PDO, cURL)
- **Database:** PostgreSQL 12+ –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º pgvector
- **AI API:** OpenRouter (–ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –º–æ–¥–µ–ª–µ–π OpenAI, Anthropic, Google, Meta)
- **Embedding Model:** text-embedding-ada-002 (1536 —Ä–æ–∑–º—ñ—Ä–Ω–æ—Å—Ç–µ–π)
- **Frontend:** Vanilla JavaScript, CSS3
- **Vectorization:** pgvector (–∫–æ—Å–∏–Ω—É—Å–Ω–∞ –ø–æ–¥—ñ–±–Ω—ñ—Å—Ç—å)

### –°—Ö–µ–º–∞ —Ä–æ–±–æ—Ç–∏ RAG

```
[–ü–∏—Ç–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞]
        ‚Üì
[–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è embedding –¥–ª—è –ø–∏—Ç–∞–Ω–Ω—è]
        ‚Üì
[–í–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫ —É PostgreSQL]
        ‚Üì
[–í—ñ–¥–±—ñ—Ä –Ω–∞–π—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ—à–∏—Ö —á–∞–Ω–∫—ñ–≤ (similarity > 0.75)]
        ‚Üì
[–§–æ—Ä–º—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∑ —á–∞–Ω–∫—ñ–≤]
        ‚Üì
[–ó–∞–ø–∏—Ç –¥–æ AI –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º]
        ‚Üì
[–í—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É + –¥–∂–µ—Ä–µ–ª–∞]
```

---

## üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### –°–∏—Å—Ç–µ–º–Ω—ñ –≤–∏–º–æ–≥–∏

- PHP 7.4 –∞–±–æ –≤–∏—â–µ
- PostgreSQL 12 –∞–±–æ –≤–∏—â–µ
- –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è PHP: PDO, pdo_pgsql, curl, json, mbstring
- –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è PostgreSQL: pgvector
- –ú—ñ–Ω—ñ–º—É–º 256MB RAM –¥–ª—è PHP

### –ö—Ä–æ–∫ 1: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è PostgreSQL —Ç–∞ pgvector

```bash
# Debian/Ubuntu
sudo apt update
sudo apt install postgresql postgresql-contrib

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è pgvector
cd /tmp
git clone https://github.com/pgvector/pgvector.git
cd pgvector
make
sudo make install
```

### –ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

```bash
# –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ PostgreSQL
sudo -u postgres psql

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–∞–∑–∏ —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
CREATE DATABASE vector_db;
CREATE USER postgres WITH PASSWORD '–≤–∞—à_–ø–∞—Ä–æ–ª—å';
GRANT ALL PRIVILEGES ON DATABASE vector_db TO postgres;

# –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏
\c vector_db

# –ê–∫—Ç–∏–≤–∞—Ü—ñ—è —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è pgvector
CREATE EXTENSION vector;
```

### –ö—Ä–æ–∫ 3: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

**index.php:**
```php
// –ó–º—ñ–Ω—ñ—Ç—å –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏
define('OPENROUTER_API_KEY', '–≤–∞—à_–∫–ª—é—á_openrouter');
define('SITE_URL', 'http://your-domain.com');
define('PG_PASS', '–≤–∞—à_–ø–∞—Ä–æ–ª—å_postgres');
```

**vector_admin.php:**
```php
$config = [
    'pg_pass' => '–≤–∞—à_–ø–∞—Ä–æ–ª—å_postgres',
    'api_key' => '–≤–∞—à_–∫–ª—é—á_openrouter',
    
    // –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ: —É–≤—ñ–º–∫–Ω—ñ—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é
    'auth_enabled' => true,
    'auth_user' => 'admin',
    'auth_pass' => '—Å–∫–ª–∞–¥–Ω–∏–π_–ø–∞—Ä–æ–ª—å',
];
```

### –ö—Ä–æ–∫ 4: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞

**Nginx –ø—Ä–∏–∫–ª–∞–¥:**
```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /var/www/ai-chat;
    index index.php;
    
    location ~ \.php$ {
        fastcgi_pass unix:/run/php/php7.4-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
    
    # –ó–∞—Ö–∏—Å—Ç –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
    location ~ ^/vector_admin\.php {
        allow 127.0.0.1;
        allow –≤–∞—à–∞_ip_–∞–¥—Ä–µ—Å–∞;
        deny all;
        
        fastcgi_pass unix:/run/php/php7.4-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

---

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### AI –ß–∞—Ç (index.php)

1. **–í—ñ–¥–∫—Ä–∏–π—Ç–µ —á–∞—Ç —É –±—Ä–∞—É–∑–µ—Ä—ñ:**
   ```
   http://your-domain.com/index.php
   ```

2. **–î–æ–¥–∞–≤–∞–Ω–Ω—è –∑–Ω–∞–Ω—å –¥–æ RAG:**
   - –ö–ª—ñ–∫–Ω—ñ—Ç—å –Ω–∞ —ñ–∫–æ–Ω–∫—É üìö (RAG)
   - –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–∞–π–ª –∞–±–æ –≤–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É
   - –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑—ñ–±'—î —Ç–µ–∫—Å—Ç –Ω–∞ —á–∞–Ω–∫–∏ —Ç–∞ —Å—Ç–≤–æ—Ä–∏—Ç—å –µ–º–±–µ–¥–¥—ñ–Ω–≥–∏

3. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —á–∞—Ç—É:**
   - –í–≤–µ–¥—ñ—Ç—å –ø–∏—Ç–∞–Ω–Ω—è —É –ø–æ–ª–µ –≤–≤–æ–¥—É
   - –Ø–∫—â–æ —î —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –≤ –±–∞–∑—ñ - RAG –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î —ó—ó
   - –ó–µ–ª–µ–Ω–∏–π –∑–Ω–∞—á–æ–∫ üìö –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ RAG
   - –ü—ñ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥–¥—é –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –¥–∂–µ—Ä–µ–ª–∞ —Ç–∞ —ó—Ö —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ—Å—Ç—å

### –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å (vector_admin.php)

1. **–í—ñ–¥–∫—Ä–∏–π—Ç–µ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å:**
   ```
   http://your-domain.com/vector_admin.php
   ```

2. **–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏:**
   - **–î–æ–¥–∞–≤–∞–Ω–Ω—è:** –í–∫–ª–∞–¥–∫–∞ "Upload" ‚Üí –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–∞–π–ª–∏ –∞–±–æ –≤–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç
   - **–ü–µ—Ä–µ–≥–ª—è–¥:** –°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –∑ –∫—ñ–ª—å–∫—ñ—Å—Ç—é —á–∞–Ω–∫—ñ–≤
   - **–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è:** –ö–ª—ñ–∫ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç ‚Üí —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –Ω–∞–∑–≤–∏ —Ç–∞ –æ–∫—Ä–µ–º–∏—Ö —á–∞–Ω–∫—ñ–≤
   - **–í–∏–¥–∞–ª–µ–Ω–Ω—è:** –ö–Ω–æ–ø–∫–∞ "‚úï" –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞

3. **–†–æ–±–æ—Ç–∞ –∑ —á–∞–Ω–∫–∞–º–∏:**
   - –ö–æ–∂–µ–Ω —á–∞–Ω–∫ –º–æ–∂–Ω–∞ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–æ
   - –ü—Ä–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –µ–º–±–µ–¥–¥—ñ–Ω–≥
   - –ú–æ–∂–Ω–∞ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ —á–∞–Ω–∫–∏ –¥–æ —ñ—Å–Ω—É—é—á–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
   - –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–¥–∞–ª–µ–Ω–Ω—è –æ–∫—Ä–µ–º–∏—Ö —á–∞–Ω–∫—ñ–≤

4. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏:**
   - –í–∫–ª–∞–¥–∫–∞ "Test" ‚Üí "Test System" –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω—å
   - –í–≤–µ–¥—ñ—Ç—å –∑–∞–ø–∏—Ç —É –ø–æ–ª–µ "Test Search" –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ—à—É–∫—É
   - –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ–∫–∞–∑—É—é—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ—Å—Ç—å (similarity score)

5. **–ï–∫—Å–ø–æ—Ä—Ç/–Ü–º–ø–æ—Ä—Ç:**
   - **–ï–∫—Å–ø–æ—Ä—Ç:** –ó–±–µ—Ä—ñ–≥–∞—î –≤—Å—é –±–∞–∑—É —É JSON —Ñ–æ—Ä–º–∞—Ç—ñ
   - **–Ü–º–ø–æ—Ä—Ç:** –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –∑ JSON —Ñ–∞–π–ª—É

---

## üîß –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ RAG

**index.php:**
```php
class VectorRAG {
    private int $chunkSize = 500;        // –†–æ–∑–º—ñ—Ä —á–∞–Ω–∫–∞ –≤ —Å–∏–º–≤–æ–ª–∞—Ö
    private int $chunkOverlap = 100;     // –ü–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è –º—ñ–∂ —á–∞–Ω–∫–∞–º–∏
}

// –ü–æ—Ä–æ–≥–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è similarity
define('MIN_SIMILARITY', 0.75);          // –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ—Å—Ç—å (75%)
define('MAX_SOURCES', 3);                // –ú–∞–∫—Å–∏–º—É–º –¥–∂–µ—Ä–µ–ª –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ
```

**vector_admin.php:**
```php
$config = [
    'chunk_size' => 800,                 // –†–æ–∑–º—ñ—Ä —á–∞–Ω–∫–∞
    'chunk_overlap' => 150,              // –ü–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è
    'max_file_size' => 10 * 1024 * 1024, // –ú–∞–∫—Å. —Ä–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—É (10MB)
    'max_files_batch' => 20,             // –ú–∞–∫—Å. —Ñ–∞–π–ª—ñ–≤ –∑–∞ —Ä–∞–∑
];
```

### –ú–æ–¥–µ–ª—ñ AI

–°–∏—Å—Ç–µ–º–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—î –±—É–¥—å-—è–∫—ñ –º–æ–¥–µ–ª—ñ –∑ OpenRouter:

- **OpenAI:** gpt-4o, gpt-4o-mini, gpt-3.5-turbo
- **Anthropic:** claude-3.5-sonnet, claude-3-opus, claude-3-haiku
- **Google:** gemini-pro, gemini-1.5-pro
- **Meta:** llama-3.1-405b, llama-3.1-70b
- **—Ç–∞ —ñ–Ω—à—ñ...**

–ó–º—ñ–Ω–∞ –º–æ–¥–µ–ª—ñ:
```javascript
// –£ —Ñ—É–Ω–∫—Ü—ñ—ó send() –≤ index.php
const requestData = {
    model: 'openai/gpt-4o',  // –ó–º—ñ–Ω—ñ—Ç—å –Ω–∞ –ø–æ—Ç—Ä—ñ–±–Ω—É –º–æ–¥–µ–ª—å
    messages: chatHistory,
    // ...
};
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

### –¢–∞–±–ª–∏—Ü—è `documents`

```sql
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,                      -- –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID
    filename VARCHAR(255) NOT NULL,             -- –ù–∞–∑–≤–∞ —Ñ–∞–π–ª—É/–¥–∂–µ—Ä–µ–ª–∞
    title VARCHAR(500),                         -- –ß–∏—Ç–∞–±–µ–ª—å–Ω–∞ –Ω–∞–∑–≤–∞
    chunk_index INT DEFAULT 0,                  -- –ù–æ–º–µ—Ä —á–∞–Ω–∫–∞
    content TEXT NOT NULL,                      -- –¢–µ–∫—Å—Ç —á–∞–Ω–∫–∞
    embedding vector(1536),                     -- –í–µ–∫—Ç–æ—Ä –µ–º–±–µ–¥–¥—ñ–Ω–≥–∞
    metadata JSONB DEFAULT '{}',                -- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ
    created_at TIMESTAMP DEFAULT NOW(),         -- –î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
    updated_at TIMESTAMP DEFAULT NOW()          -- –î–∞—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
);

-- –Ü–Ω–¥–µ–∫—Å –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ—à—É–∫—É (IVFFlat)
CREATE INDEX idx_docs_embedding 
ON documents USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 100);

-- –Ü–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–≤–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ—à—É–∫—É
CREATE INDEX idx_docs_content 
ON documents USING gin(to_tsvector('russian', content));

-- –Ü–Ω–¥–µ–∫—Å –¥–ª—è filename
CREATE INDEX idx_docs_filename ON documents (filename);
```

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î

```bash
# –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ psql
psql -h localhost -U postgres -d vector_db -c "SELECT COUNT(*) FROM documents;"
```

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è API

```bash
# –¢–µ—Å—Ç OpenRouter API
curl -X POST https://openrouter.ai/api/v1/chat/completions \
  -H "Authorization: Bearer –≤–∞—à_–∫–ª—é—á" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "openai/gpt-4o-mini",
    "messages": [{"role": "user", "content": "–ü—Ä–∏–≤—ñ—Ç!"}]
  }'
```

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ—à—É–∫—É

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ vector_admin.php
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Test"
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "Test System" - –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –≤—Å—ñ –∑–µ–ª–µ–Ω—ñ –≥–∞–ª–æ—á–∫–∏
4. –í–≤–µ–¥—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤–∏–π –∑–∞–ø–∏—Ç —É "Test Search"

---

## üîê –ë–µ–∑–ø–µ–∫–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –∑ –±–µ–∑–ø–µ–∫–∏

1. **–ó–º—ñ–Ω—ñ—Ç—å –ø–∞—Ä–æ–ª—ñ:**
   - PostgreSQL –ø–∞—Ä–æ–ª—å —É –æ–±–æ—Ö —Ñ–∞–π–ª–∞—Ö
   - –ü–∞—Ä–æ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —É vector_admin.php

2. **–û–±–º–µ–∂—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ:**
   ```nginx
   location ~ ^/vector_admin\.php {
       allow 127.0.0.1;
       allow –≤–∞—à–∞_ip;
       deny all;
   }
   ```

3. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ HTTPS:**
   ```bash
   sudo certbot --nginx -d your-domain.com
   ```

4. **–ü—Ä–∏—Ö–æ–≤–∞–π—Ç–µ API –∫–ª—é—á—ñ:**
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `.env` —Ñ–∞–π–ª–∏
   - –ù–µ –∫–æ–º–º—ñ—Ç—å—Ç–µ –∫–ª—é—á—ñ –≤ Git

5. **–†–µ–≥—É–ª—è—Ä–Ω—ñ –±–µ–∫–∞–ø–∏:**
   ```bash
   # –ë–µ–∫–∞–ø –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
   pg_dump -U postgres vector_db > backup_$(date +%Y%m%d).sql
   
   # –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
   psql -U postgres vector_db < backup_20240101.sql
   ```

---

## üêõ –í–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ PostgreSQL

**–†—ñ—à–µ–Ω–Ω—è:**
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å PostgreSQL
sudo systemctl status postgresql

# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
sudo nano /etc/postgresql/*/main/pg_hba.conf

# –î–æ–¥–∞–π—Ç–µ —Ä—è–¥–æ–∫:
local   all   all   md5
```

### –ü—Ä–æ–±–ª–µ–º–∞: –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è pgvector –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ

**–†—ñ—à–µ–Ω–Ω—è:**
```bash
# –ü–µ—Ä–µ–≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å pgvector
cd /tmp/pgvector
sudo make install

# –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ –±–∞–∑–∏
sudo -u postgres psql vector_db
CREATE EXTENSION IF NOT EXISTS vector;
```

### –ü—Ä–æ–±–ª–µ–º–∞: API –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ–º–∏–ª–∫—É 401

**–†—ñ—à–µ–Ω–Ω—è:**
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å API –∫–ª—é—á–∞ OpenRouter
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —É –≤–∞—Å —î –∫—Ä–µ–¥–∏—Ç–∏ –Ω–∞ –±–∞–ª–∞–Ω—Å—ñ
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –æ–±–º–µ–∂–µ–Ω–Ω—è rate limit

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–≤—ñ–ª—å–Ω–∏–π –≤–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫

**–†—ñ—à–µ–Ω–Ω—è:**
```sql
-- –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —ñ–Ω–¥–µ–∫—Å—É
DROP INDEX IF EXISTS idx_docs_embedding;
CREATE INDEX idx_docs_embedding 
ON documents USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 200);  -- –ó–±—ñ–ª—å—à–∏—Ç–∏ lists –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –±–∞–∑

-- –í–∞–∫—É—É–º—ñ–∑–∞—Ü—ñ—è
VACUUM ANALYZE documents;
```

---

## üìà –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

### PHP –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

```ini
; php.ini
memory_limit = 512M
max_execution_time = 180
upload_max_filesize = 20M
post_max_size = 20M
```

### PostgreSQL –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

```conf
# postgresql.conf
shared_buffers = 256MB
effective_cache_size = 1GB
maintenance_work_mem = 64MB
max_connections = 100
```

### Nginx –∫–µ—à—É–≤–∞–Ω–Ω—è

```nginx
# –ö–µ—à—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤
location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

---

## üìö –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ç–∏–ø—ñ–≤ —Ñ–∞–π–ª—ñ–≤

```php
// –£ vector_admin.php
$config['allowed_extensions'] = [
    'txt', 'md', 'html', 'csv', 'json',
    'pdf', 'docx', 'xml'  // –î–æ–¥–∞–π—Ç–µ –Ω–æ–≤—ñ
];

// –î–æ–¥–∞–π—Ç–µ –æ–±—Ä–æ–±–Ω–∏–∫ —É –º–µ—Ç–æ–¥ processUploadedFile()
```

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –º—É–ª—å—Ç–∏–º–æ–≤–Ω–æ—Å—Ç—ñ

```sql
-- –î–æ–¥–∞–π—Ç–µ —ñ–Ω–¥–µ–∫—Å –¥–ª—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –º–æ–≤–∏
CREATE INDEX idx_docs_content_uk 
ON documents USING gin(to_tsvector('ukrainian', content));

-- –î–ª—è –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó
CREATE INDEX idx_docs_content_en 
ON documents USING gin(to_tsvector('english', content));
```

### –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —ñ–Ω—à–∏–º–∏ AI –º–æ–¥–µ–ª—è–º–∏

```javascript
// –î–æ–¥–∞–π—Ç–µ –≤ index.php
const models = {
    'gpt4': 'openai/gpt-4o',
    'claude': 'anthropic/claude-3.5-sonnet',
    'gemini': 'google/gemini-pro'
};

// –î–æ–∑–≤–æ–ª—å—Ç–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –æ–±–∏—Ä–∞—Ç–∏ –º–æ–¥–µ–ª—å
```

---

## üìÑ API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

### –ï–Ω–¥–ø–æ—ñ–Ω—Ç–∏ index.php

**POST /** - –û—Å–Ω–æ–≤–Ω–∏–π –æ–±—Ä–æ–±–Ω–∏–∫

–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:
- `action=send_message` - –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
  - `message` (string) - –¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
  - –í—ñ–¥–ø–æ–≤—ñ–¥—å: `{message, model, rag_used, sources, error}`

- `action=get_history` - –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é
  - –í—ñ–¥–ø–æ–≤—ñ–¥—å: `{history: [{role, content}]}`

- `action=clear_history` - –û—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é
  - –í—ñ–¥–ø–æ–≤—ñ–¥—å: `{success: true}`

- `action=rag_stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ RAG
  - –í—ñ–¥–ø–æ–≤—ñ–¥—å: `{total_files, total_chunks}`

- `action=rag_list` - –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
  - –í—ñ–¥–ø–æ–≤—ñ–¥—å: `{documents: [{filename, title, chunks}]}`

- `action=rag_upload` - –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª
  - `file` (file) - –§–∞–π–ª –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
  - –í—ñ–¥–ø–æ–≤—ñ–¥—å: `{success, chunks_added, error}`

### –ï–Ω–¥–ø–æ—ñ–Ω—Ç–∏ vector_admin.php

**POST /** - –ê–¥–º—ñ–Ω –æ–ø–µ—Ä–∞—Ü—ñ—ó

- `action=upload_files` - –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª–∏
- `action=add_manual` - –î–æ–¥–∞—Ç–∏ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É
- `action=delete_document` - –í–∏–¥–∞–ª–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç
- `action=update_document_title` - –û–Ω–æ–≤–∏—Ç–∏ –Ω–∞–∑–≤—É
- `action=get_chunk` - –û—Ç—Ä–∏–º–∞—Ç–∏ —á–∞–Ω–∫
- `action=update_chunk` - –û–Ω–æ–≤–∏—Ç–∏ —á–∞–Ω–∫
- `action=delete_chunk` - –í–∏–¥–∞–ª–∏—Ç–∏ —á–∞–Ω–∫
- `action=add_chunk` - –î–æ–¥–∞—Ç–∏ —á–∞–Ω–∫
- `action=export_data` - –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ
- `action=import_data` - –Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ

---

## ü§ù –í–Ω–µ—Å–æ–∫ —É –ø—Ä–æ–µ–∫—Ç

–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –ø—Ä–æ–µ–∫—Ç:

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É –≥—ñ–ª–∫—É (`git checkout -b feature/amazing-feature`)
3. –ó—Ä–æ–±—ñ—Ç—å –∑–º—ñ–Ω–∏ —Ç–∞ commit (`git commit -m 'Add amazing feature'`)
4. Push –¥–æ –≥—ñ–ª–∫–∏ (`git push origin feature/amazing-feature`)
5. –°—Ç–≤–æ—Ä—ñ—Ç—å Pull Request

---

## üìù –õ—ñ—Ü–µ–Ω–∑—ñ—è

MIT License - –≤–∏ –º–æ–∂–µ—Ç–µ –≤—ñ–ª—å–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Ç–∞ —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂—É–≤–∞—Ç–∏ —Ü–µ–π –∫–æ–¥.

---

## üôè –ü–æ–¥—è–∫–∏

- OpenRouter –∑–∞ API –¥–æ—Å—Ç—É–ø –¥–æ —Ä—ñ–∑–Ω–∏—Ö AI –º–æ–¥–µ–ª–µ–π
- pgvector –∑–∞ —á—É–¥–æ–≤–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è PostgreSQL
- –°–ø—ñ–ª—å–Ω–æ—Ç—ñ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ –∑–∞ –≤—ñ–¥–∫—Ä–∏—Ç—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

---

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–ü—Ä–∏ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—ñ –ø—Ä–æ–±–ª–µ–º:

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–æ–∑–¥—ñ–ª "–í–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º"
2. –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –ª–æ–≥–∏ PHP —Ç–∞ PostgreSQL
3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ
4. –°—Ç–≤–æ—Ä—ñ—Ç—å issue —É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –ø—Ä–æ–µ–∫—Ç—É

---

**–í–µ—Ä—Å—ñ—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó:** 1.0  
**–û—Å—Ç–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** 2024  
**–°—É–º—ñ—Å–Ω—ñ—Å—Ç—å:** PHP 7.4+, PostgreSQL 12+, pgvector 0.5.0+

---

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç (TL;DR)

```bash
# 1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å PostgreSQL + pgvector
sudo apt install postgresql
cd /tmp && git clone https://github.com/pgvector/pgvector.git
cd pgvector && make && sudo make install

# 2. –°—Ç–≤–æ—Ä—ñ—Ç—å –±–∞–∑—É
sudo -u postgres psql
CREATE DATABASE vector_db;
CREATE EXTENSION vector;

# 3. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —É —Ñ–∞–π–ª–∞—Ö
# - –ó–º—ñ–Ω—ñ—Ç—å OPENROUTER_API_KEY
# - –ó–º—ñ–Ω—ñ—Ç—å PG_PASS
# - –ó–º—ñ–Ω—ñ—Ç—å auth –ø–∞—Ä–æ–ª—ñ

# 4. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —É –±—Ä–∞—É–∑–µ—Ä—ñ
http://your-domain.com/index.php         # –ß–∞—Ç
http://your-domain.com/vector_admin.php  # –ê–¥–º—ñ–Ω
```

**–ì–æ—Ç–æ–≤–æ! üéâ**
